\documentclass{article} 

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{float}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{hyperref}
\usepackage{amssymb}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
% \usepackage{titlesec}
\usepackage[shortlabels]{enumitem}
 
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\setcounter{MaxMatrixCols}{20}


\usepackage{geometry}
 \geometry{
 a4paper,
 left=17.5mm,
 right=17.5mm,
 top=20mm,
 bottom=15mm
}

\title{227A Final Project}

\author{Boying Gong (SID: 24967354)}

\begin{document}

\twocolumn

\maketitle


% ========================= PART 1 =========================

\input{1UncertaintyModel.tex}

% ========================= PART 2 =========================

\section{\textbf{Decision Making}}

In this section, we provide the brief formulation of four strategies built in a rolling horizon fashion. They are: the naive strategy, the robust strategy, the rolling strategy and the relative robust strategy. We will show that the later three actually results in the same decision for rolling-horizon based implementation.

For a detailed problem formulation and variable definition, please refer to Appendix \ref{apx:problemFormulation}.

% ================== Naive Strategy ==================

\subsection{Naive Strategy}

    Let $C^{(1)}_{initial} = 70.3$ be the amount that the company has at the beginning of the horizon. We assume the future liability be $\hat{b}(t)$ without error.

    In January (i = 1), let $x^{(1)}=(x^{(1)}_{cash}, x^{(1)}_{cp}, x^{(1)}_{cre})$ be the decision variables $, x^{(1)}_{cash}\in\mathbb{R}^6, x^{(1)}_{cp}\in\mathbb{R}^3, x^{(1)}_{cre}\in\mathbb{R}^5$. We can write the optimization problem as follows.
    \begin{equation}
        \min_x c_1^Tx: A_1x+l_1\geq\hat{b}(t), 0\leq x\leq \bar{x}_1.
    \end{equation}
    where $l_1=\begin{pmatrix}C^{(1)}_{initial} & 0& 0& 0& 0& 0\end{pmatrix}^T$ represents the initial funds. Only the first of these decisions $x^{(1)}_{cre}(1)$, $x^{(1)}_{cp}(1)$ and $x^{(1)}_{cash}(1)$ will be implemented. Given the realization of the first month liability $\beta_1$, if the cash amount we reserved for liability is less than $\beta_1$, the strategy fails. If not, the extra part becomes the initial fund in Feburary.

    In Feburary ($i = 2$),  we re-estimate the AR model and the uncertainty model. The optimization problem for the second month is built on the updated parameters. And the number of decision variable is reduced by 3. That is, $x^{(2)}=(x^{(2)}_{cash}, x^{(2)}_{cp}, x^{(2)}_{cre}), x^{(2)}_{cash}\in\mathbb{R}^5, x^{(2)}_{cp}\in\mathbb{R}^2, x^{(2)}_{cre}\in\mathbb{R}^4$.

    Eventually, we will be solving six optimizaiton problems sequentially, one for each month($i = 1, \cdots, 6$):
    \begin{equation}
        \min_x c_i^Tx: A_ix+l_i\geq\hat{b}(t+i-1), 0\leq x\leq \bar{x}_i.
    \end{equation}

% ================== Robust Strategy ==================

\subsection{Robust Strategy}

    Consider the robust counterpart of the naive strategy. Assume the liability vector is a function of uncertainty. In month $i$, the liability is a realization from the set $\mathcal{U}(t+i-1)$. For the rolling strategy, we will be solving the following optimizaiton problems sequentially, one for each month($i = 1, \cdots, 6$):
    \[\begin{split}
        \min_x\ & c_i^Tx,\\
        \text{s.t. }& A_ix+l_i\geq b(t+i-1), \forall b(t+i-1)\in\mathcal{U}(t+i-1) ,\\
        & 0\leq x\leq \bar{x_i}.
    \end{split}\]
    They are equivalent to the following LP problems:
    \[\begin{split}
        \min_x\ & c_i^Tx,\\
        \text{s.t. }& A_ix+l_i\geq b(t+i-1)+|B(t+i-1)|\textbf{1} ,\\
        & 0\leq x\leq \bar{x_i}.
    \end{split}\]

% ========= Affine Strategy =========

\subsection{Affine Strategy}

    For the affine strategy, we assume that the decision variables are linear functions of previous information. we will be solving the following optimizaiton problems sequentially ($i = 1, \cdots, 6$):
    


% ========= Relative Robust Strategy =========

    \begin{figure*}
       \centering
       \includegraphics[width=0.45\textwidth]{regret.png}
        \caption{Regret histogram of more test data}
        \label{fig:regret}
    \end{figure*}

\subsection{Relative Robust Strategy}

    For the relative robust strategy, we consider minimizing the maximum regret for problem (\ref{eq:robust}). The regret function measures the difference between the performance of the solution with and without the full knowledge of the future. Assume we choose $x$ as decision vector, $u$ is the vector of realized parameter values and $x^*(u)$ is the optimal decision vector if $u$ is available. The regret associated with having chosen $x$ rather than $x^*(u)$ as decision vector is defined as follows,
    \[
        r(x, u) =  c^Tx - c^Tx^*(u).
    \]
    The regret will always be greater than 0. The relative robust problem of minimizing the maximum regret can be formulated as follows
    \[\begin{split}
        \min_{x} & \big\{ \quad\max_{||u||_\infty\leq 1} \big\{c^Tx - 
        \min_{\{y:Ay+l\geq \hat{b}(t)+B(t)u, 0\leq y\leq \bar{x} \}} c^Ty\big\}\big\}. \\
        \text{s.t. } & Ax+l\geq \hat{b}(t) + B(t)u, \forall ||u||_\infty\leq 1, \\
        & 0\leq x\leq \bar{x}.
    \end{split}\]
    Introducing a slack variable $\gamma$ that expresses an upper bound on the regret, we can equivalently reformulate this problem as follows,
    \[\begin{split}
        \min_{x, y, \gamma}\ & \gamma \\
        \text{s.t. } 
        & Ax+l\geq \hat{b}(t) + B(t)u, \forall ||u||_\infty\leq 1,  \\
        & 0\leq x\leq \bar{x}, \\
        & \gamma \geq c^Tx + \max_{||u||_\infty\leq 1} \big\{
        \max_{\{y:Ay+l\geq \hat{b}(t)+B(t)u, 0\leq y\leq \bar{x} \}} - c^Ty\big\}.
    \end{split}\]
    Similar to the robust problem and the affine problem, this can also be expressed as{} follows
    \begin{equation}\label{eq:relative}\begin{split}
        \min_{x, y, \gamma}\ & \gamma \\
        \text{s.t. } 
        & Ax+l\geq \hat{b}(t) + |B(t)|\textbf{1}, \\
        & 0\leq x\leq \bar{x}, \\
        & \gamma \geq c^Tx + \max_{||u||_\infty\leq 1} \big\{
        \max_{\{y:Ay+l\geq \hat{b}(t)+B(t)u, 0\leq y\leq \bar{x} \}} - c^Ty\big\}.
    \end{split}\end{equation}
    Notice that the set $\{||u||_\infty \leq 1\}$ can be expressed as a convex hull of a finite number of extreme scenarios, namely
    \[\{||u||_\infty \leq 1\} = \text{conv}(\{u^{[i]}, i = 1, \cdots, 2^T\})\]
    We have the following lemma:

    \begin{lemma}
        The following are equivalent, 
        \begin{enumerate}
            \item $-c^Tx+\gamma \geq
            \max_{\{y:Ay+l\geq \hat{b}(t)+B(t)u, 0\leq y\leq \bar{x} \}} - c^Ty,$\\ $\forall ||u||_\infty\leq 1,$
            \item $-c^Tx+\gamma \geq
            \max_{\{y:Ay+l\geq \hat{b}(t)+B(t)u^{[i]}, 0\leq y\leq \bar{x} \}} - c^Ty,$\\$ i = 1, \cdots, 2^T$.
        \end{enumerate}
    \end{lemma}
    \emph{Proof. } For the proof, please refer to Corollary 4.1 in \cite{hauser2013relative}.

    Thus, problem (\ref{eq:relative}) is equivalent to 
    \begin{equation}\label{eq:relative_final}\begin{split}
        \min_{x, y, \gamma}\ & \gamma \\
        \text{s.t. } 
        & Ax+l\geq \hat{b}(t) + |B(t)|\textbf{1}, \\
        & 0\leq x\leq \bar{x}, \\
        & \gamma \geq c^Tx + g(i),  i = 1, \cdots, 2^T, \\
        & g(i) = \max_{\{y:Ay+l\geq \hat{b}(t)+B(t)u^{[i]}, 0\leq y\leq \bar{x} \}} - c^Ty.
    \end{split}\end{equation}

    We can solve problem (\ref{eq:relative_final}) with a two-step procedure where we first solve an LP problem for $y$ (that is, solve $g(i)$), and then solve the LP problem for $x$ and $\gamma$.

    Notice that the optimal solution of (\ref{eq:relative}) is equal to the optimal solution of the robust problem (\ref{eq:robust_final}). To see this fact, let $g = \max_i g(i)$. $g$ can be treated as a constant since $g(i)$ can be solved explicitly. Then (\ref{eq:relative}) is quivalent to the following
    \[\begin{split}
        \min_{x, y}\ & c^Tx + g \\
        \text{s.t. } 
        & Ax+l\geq \hat{b}(t) + |B(t)|\textbf{1}, \\
        & 0\leq x\leq \bar{x}.
    \end{split}\]
    which is the same as (\ref{eq:relative}). Note that the robust solution and relative robust optimization problem does not usually equivalent to each other without the linearity of object and contraints function. 

% ========================= PART 3 =========================

\section{\textbf{Evaluation Metrics}}

\subsection{Test Data}

    \begin{table}[H]
        \begin{tabular}{|l|p{1.3cm}|p{1.3cm}|p{1.3cm}|p{1.3cm}|}
        \hline
        & Naive & Robust & Affine & Relative Robust \\ 
        \hline
        Regret & 8.71 & 56.90 & 52.97 & 56.90 \\
        \hline
        \end{tabular}
        \caption{Regret for test data}
    \end{table}

\subsection{More Test Data}



\bibliographystyle{plain}
\bibliography{Proof_of_Correctness.bib}

\clearpage
\newpage
\appendix

\onecolumn

% ======================= Appendix A =======================

\input{App1ProblemFormulation}


% ======================= Appendix B =======================


\section{Analysis on not-rolling-based strategy}\label{apx:notRollingStrategy}


% ======================= Appendix C =======================

\input{App3RecursiveSubstitution}

\section{Code}\label{apx:code}

All the code for this project can be found in the Github repository \url{https://github.com/boyinggong/227A_final_project}


\end{document}
